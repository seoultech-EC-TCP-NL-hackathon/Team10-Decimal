<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>강의 녹음 요약 AI</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body> 
    <!-- 사이드바 -->
    <div class="sidebar">
        <!-- 사이드바 탭 -->
        <div class="sidebar-tabs">
            <!-- 사이드바 토글 버튼-->
            <button class="sidebar-toggle-btn" onclick="toggleSidebarMini()" title="사이드바 접기/펼치기">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="sidebar-tab active" data-panel="summaries" title="요약 기록">
                <i class="fas fa-history"></i>
            </div>
            <div class="sidebar-tab" data-panel="directories" title="로컬 디렉토리">
                <i class="fas fa-folder"></i>
            </div>
        </div>

        <!-- 사이드바 패널들 -->
        <div class="sidebar-panels">
            <!-- 요약 기록 패널 -->
            <div class="sidebar-panel active" id="summaries-panel">
                <div class="panel-header">
                    <h3>요약 기록</h3>
                    <div class="panel-controls">
                        <button class="control-btn" onclick="refreshSummaries()" title="새로고침">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="control-btn" onclick="clearAllSummaries()" title="모두 삭제">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="summaries-list" id="summariesList">
                        <!-- 최신순 요약들이 여기 표시됩니다 -->
                    </div>
                </div>
            </div>

            <!-- 로컬 디렉토리 패널 -->
            <div class="sidebar-panel" id="directories-panel">
                <div class="panel-header">
                    <h3>로컬 디렉토리</h3>
                    <div class="panel-controls">
                        <button class="control-btn" onclick="openLocalFolder()" title="폴더 열기">
                            <i class="fas fa-folder-open"></i>
                        </button>
                        <button class="control-btn" onclick="createNewFolderFromButton()" title="새 폴더" id="newFolderBtn" style="display: none;">
                            <i class="fas fa-folder-plus"></i>
                        </button>
                        <button class="control-btn" onclick="refreshDirectories()" title="새로고침">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="directory-empty" id="directoryEmpty">
                        <i class="fas fa-folder-open" style="font-size: 48px; color: #666; margin-bottom: 16px;"></i>
                        <p style="color: #999; margin-bottom: 16px;">로컬 폴더를 선택하세요</p>
                        <button class="control-btn" onclick="openLocalFolder()" style="padding: 8px 16px;">
                            <i class="fas fa-folder-open"></i> 폴더 열기
                        </button>
                    </div>
                    <div class="directory-tree" id="directoryTree" style="display: none;">
                        <!-- 실제 로컬 폴더 구조가 여기 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 키보드 단축키 안내 -->
        <div class="keyboard-shortcuts">
            <h4>키보드 단축키</h4>
            <p><kbd>Ctrl/Cmd + N</kbd> 새 세션</p>
            <p><kbd>Ctrl/Cmd + R</kbd> 녹음 시작/중지</p>
        </div>
        
        <!-- 오픈소스 정보 버튼 -->
        <div class="opensource-info">
            <button class="opensource-btn" onclick="showOpenSourceInfo()" title="오픈소스 라이선스">
                <i class="fas fa-code"></i>
                <span>오픈소스 정보</span>
            </button>
        </div>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <!-- 탭 바 -->
        <div class="tab-bar" id="tabBar">
            <div class="tab welcome-tab active" data-tab-id="welcome">
                <span class="tab-title">시작하기</span>
                <i class="fas fa-home tab-icon"></i>
            </div>
        </div>

        <!-- 탭 콘텐츠들 -->
        <div class="tab-contents">
            <!-- 환영 탭 -->
            <div class="tab-content active" id="welcome-content">
                <!-- 시작 옵션 -->
                <div class="welcome-options">
                    <div class="option-card" onclick="startRecording()">
                        <div class="option-icon">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <h3>실시간 녹음</h3>
                        <p>마이크를 사용하여 실시간으로 강의를 녹음하고 요약합니다</p>
                    </div>
                    <div class="option-card" onclick="uploadFile()">
                        <div class="option-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <h3>파일 업로드</h3>
                        <p>기존 녹음 파일을 업로드하여 요약합니다</p>
                    </div>
                </div>

                <!-- 최근 요약 미리보기 -->
                <div class="recent-summaries-preview">
                    <h2>최근 요약</h2>
                    <div class="recent-items" id="recentItems">
                        <!-- 최근 요약들이 여기에 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 새 파일 메뉴 -->
        <div class="new-file-menu" id="newFileMenu">
            <div class="menu-item" onclick="startRecording()">
                <i class="fas fa-microphone"></i>
                <span>실시간 녹음</span>
            </div>
            <div class="menu-item" onclick="uploadFile()">
                <i class="fas fa-upload"></i>
                <span>파일 업로드</span>
            </div>
        </div>

        <!-- 녹음/업로드 모달 -->
        <div class="recording-modal" id="recordingModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">실시간 녹음</h3>
                    <div class="modal-header-actions">
                        <button type="button" class="minimize-btn" onclick="minimizeRecordingModal()" title="최소화">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button type="button" class="close-btn" onclick="closeRecordingModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <!-- 녹음 컨트롤 -->
                    <div class="recording-controls" id="recordingControls">
                        <div class="recording-section">
                            <div class="recording-controls-initial">
                                <button type="button" class="record-btn primary" id="recordBtn" onclick="toggleRecording()">
                                    <i class="fas fa-microphone"></i>
                                    <span>녹음 시작</span>
                                </button>
                                <div class="recording-status" id="recordingStatus">
                                    <div class="status-row">
                                        <span class="status-text">준비됨</span>
                                        <div class="recording-timer" id="recordingTimer">00:00</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 파일 업로드 -->
                    <div class="upload-controls" id="uploadControls" style="display: none;">
                        <div class="upload-area">
                            <!-- 파일 다중 업로드 -->
                            <input type="file" id="audioFile" accept="audio/*" multiple style="display: none;" onchange="handleFileUpload(event)">
                            <div class="upload-drop-zone" onclick="document.getElementById('audioFile').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>클릭하여 파일 선택</p>
                                <p class="upload-hint">또는 파일을 여기로 드래그하세요</p>
                            </div>

                            <!-- 업로드 파일 확인 -->
                            <div class="upload-preview" id="uploadPreview"></div>
                        </div>
                    </div>

                    <!-- 폴더 선택 섹션 -->
                    <div class="folder-selection-section">
                        <div class="folder-selection-header">
                            <i class="fas fa-folder-tree"></i>
                            <span>저장 위치 선택</span>
                        </div>
                        
                        <!-- Workspace 선택 -->
                        <div class="folder-input-group">
                            <label for="workspaceSelect">
                                <i class="fas fa-briefcase"></i> Workspace
                            </label>
                            <div class="folder-input-row">
                                <select id="workspaceSelect">
                                    <option value="">-- Workspace 선택 또는 생성 --</option>
                                </select>
                                <button type="button" class="folder-new-btn" onclick="createNewWorkspace(event)" title="새 Workspace">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Subject 입력 -->
                        <div class="folder-input-group">
                            <label for="subjectInput">
                                <i class="fas fa-book"></i> Subject (새로 생성)
                            </label>
                            <input type="text" id="subjectInput" placeholder="예: 1주차, 2주차..." disabled>
                        </div>

                        <div class="folder-selection-hint">
                            <i class="fas fa-info-circle"></i>
                            <span>summary/<strong class="workspace-preview">workspace</strong>/<strong class="subject-preview">subject</strong></span>
                        </div>
                    </div>

                    <!-- 처리 버튼 -->
                    <div class="modal-actions">
                        <label class="lang-flag">
                            <input type="checkbox" id="flagKoreanOnly">
                            한국어로 이루어진 파일입니다.
                        </label>

                        <button type="button" class="summarize-btn" id="summarizeBtn" onclick="summarizeAudio(event)" disabled>
                            <i class="fas fa-magic"></i>
                            <span>요약 생성</span>
                        </button>
                        
                        <button type="button" class="cancel-btn" onclick="closeRecordingModal()">
                            <span>취소</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!--로딩 오버레이 -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>강의 내용 분석 중…</p>
            </div>
        </div>

        <!-- 녹음 미니바 (최소화 시 표시) -->
        <div class="recording-minibar" id="recordingMinibar" style="display: none;" onclick="restoreRecordingModal()">
            <div class="minibar-content">
                <div class="minibar-icon">
                    <i class="fas fa-microphone"></i>
                </div>
                <div class="minibar-info">
                    <span class="minibar-status" id="minibarStatus">녹음 중</span>
                    <span class="minibar-timer" id="minibarTimer">00:00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 컨텍스트 메뉴 -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <div class="context-menu-item" onclick="createNewFolderInLocal()">
            <i class="fas fa-folder-plus"></i>
            <span>새 폴더</span>
        </div>
        <div class="context-menu-item" onclick="selectWorkspaceFolder()">
            <i class="fas fa-check-circle"></i>
            <span>Workspace/Subject 선택</span>
        </div>
        <div class="context-menu-item context-menu-delete" onclick="deleteFolderOrFile()">
            <i class="fas fa-trash"></i>
            <span>삭제</span>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="script.js"></script>
</body>
</html>